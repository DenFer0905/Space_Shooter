<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Space Shooter</title>
<style>
body {
  margin: 0;
  overflow: hidden;
  font-family: Arial, sans-serif;
}

#game {
  position: relative;
  width: 100vw;
  height: 100vh;
  background: url('sfondospazio.jpg') no-repeat center center;
  background-size: cover;
  overflow: hidden;
}

#score {
  position: absolute;
  top: 20px;
  left: 20px;
  font-size: 24px;
  color: white;
  font-weight: bold;
  z-index: 10;
  text-shadow: 2px 2px 4px #000;
}

#shark {
  position: absolute;
  bottom: 200px;
  left: 30%;
  width: 105px;
  height: auto;
  z-index: 5;
  transition: transform 0.5s;
}

/* HITBOX NAVICELLA */
#sharkHitbox {
  position: absolute;
  width: 50px;      /* più stretta */
  height: 12px;      /* più bassa */
  left: 55px;       /* spostata leggermente a destra */
  bottom: 40px;     /* abbassata di 20px rispetto alla navicella */
  z-index: 6;
  pointer-events: none;
  background: rgba(255,0,0,0.3); /* visibile solo per debug */
}

.fish {
  position: absolute;
  width: 60px;
  height: 6bvhb 0px;
  background: url('sfera.png') no-repeat center center;
  background-size: cover;
  border-radius: 50%;
  z-index: 4;
}

.bigFish {
  position: absolute;
  width: 80px;
  height: 80px;
  background: url('sfera.png') no-repeat center center;
  background-size: cover;
  border-radius: 50%;
  z-index: 4;
}

.obstacle {
  position: absolute;
  width: 70px;
  height: 70px;
  background: url('roccia.png') no-repeat center center;
  background-size: cover;
  z-index: 4;
}

.bullet {
  position: absolute;
  width: 15px;
  height: 5px;
  background-color: rgb(93, 247, 4);
  border-radius: 2px;
  z-index: 6;
}

/* === GAME OVER SCREEN === */
#gameOverScreen {
  display: none;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: rgba(0,0,0,0.85);
  color: white;
  padding: 40px;
  border-radius: 12px;
  text-align: center;
  z-index: 1000;
}
#gameOverScreen h1 {
  margin: 0 0 10px;
  font-size: 36px;
}
#gameOverScreen button {
  margin-top: 20px;
  padding: 10px 20px;
  font-size: 18px;
  background: #ff4747;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
}
#gameOverScreen button:hover {
  background: #ff3030;
}
</style>
</head>
<body>
<div id="game">
  <div id="score">Punti: 0</div>
  <img id="shark" src="navicella.webp" alt="Navicella">
  <div id="sharkHitbox"></div>
</div>

<!-- GAME OVER SCREEN -->
<div id="gameOverScreen">
  <h1>Game Over</h1>
  <p>Punti: <span id="finalScore"></span></p>
  <button onclick="location.reload()">Riprova</button>
</div>

<script>
// === VARIABILI PRINCIPALI ===
const shark = document.getElementById("shark");
const sharkHitbox = document.getElementById("sharkHitbox");
const game = document.getElementById("game");
const scoreDisplay = document.getElementById("score");

let sharkBottom = 200;
let isPressing = false;
let score = 0;
let gameOver = false;

const speedUp = 16;
const speedDown = 13.8;
const maxBottom = window.innerHeight - 80;
const minBottom = 0;

let obstacles = [];
let fishes = [];
let bigFishes = [];
let bullets = [];

// === CONTROLLI ===
document.body.addEventListener("mousedown", () => isPressing = true);
document.body.addEventListener("mouseup", () => isPressing = false);
document.body.addEventListener("touchstart", () => isPressing = true);
document.body.addEventListener("touchend", () => isPressing = false);

// === MOVIMENTO NAVICELLA + HITBOX ===
function moveShark() {
  if(gameOver) return;
  sharkBottom += isPressing ? speedUp : -speedDown;
  if(sharkBottom > maxBottom) sharkBottom = maxBottom;
  if(sharkBottom < minBottom) sharkBottom = minBottom;
  shark.style.bottom = sharkBottom + "px";

  // sincronizza hitbox con navicella
  sharkHitbox.style.left = (shark.offsetLeft + 35) + "px";
  sharkHitbox.style.bottom = (sharkBottom + 20) + "px";

  requestAnimationFrame(moveShark);
}

// === GESTIONE OGGETTI ===
function spawnObstacle() {
  if(gameOver) return;
  const obs = document.createElement("div");
  obs.classList.add("obstacle");
  obs.style.right = "-40px";
  obs.style.bottom = Math.random() * (window.innerHeight - 40) + "px";
  game.appendChild(obs);
  obstacles.push(obs);
  setTimeout(spawnObstacle, 100 + Math.random()*100);
}

function spawnFish() {
  if(gameOver) return;
  const fish = document.createElement("div");
  fish.classList.add("fish");
  fish.style.right = "-40px";
  fish.style.bottom = Math.random() * (window.innerHeight - 40) + "px";
  game.appendChild(fish);
  fishes.push(fish);
  setTimeout(spawnFish, 300 + Math.random()*150);
}

function spawnBigFish() {
  if(gameOver) return;
  const bigFish = document.createElement("div");
  bigFish.classList.add("bigFish");
  bigFish.style.right = "-60px";
  bigFish.style.bottom = Math.random() * (window.innerHeight - 60) + "px";
  game.appendChild(bigFish);
  bigFishes.push(bigFish);
  setTimeout(spawnBigFish, 1000 + Math.random()*1000);
}

// === AGGIORNAMENTO OGGETTI E COLLISIONI ===
function updateObjects() {
  if(gameOver) return;

  obstacles.forEach((obj,i)=>{
    let right = parseFloat(obj.style.right);
    right += 12;
    obj.style.right = right + "px";
    if(right > window.innerWidth + 40){ obj.remove(); obstacles.splice(i,1); }
    if(checkCollision(sharkHitbox,obj)) endGame();
  });

  fishes.forEach((obj,i)=>{
    let right = parseFloat(obj.style.right);
    right += 12;
    obj.style.right = right + "px";
    if(right > window.innerWidth + 40){ obj.remove(); fishes.splice(i,1); }
    if(checkCollision(sharkHitbox,obj)){ 
      score++; scoreDisplay.textContent="Punti: "+score; 
      obj.remove(); fishes.splice(i,1); 
    }
  });

  bigFishes.forEach((obj,i)=>{
    let right = parseFloat(obj.style.right);
    right += 12;
    obj.style.right = right + "px";
    if(right > window.innerWidth + 60){ obj.remove(); bigFishes.splice(i,1); }
    if(checkCollision(sharkHitbox,obj)){ 
      score+=3; scoreDisplay.textContent="Punti: "+score; 
      obj.remove(); bigFishes.splice(i,1); 
    }
  });

  requestAnimationFrame(updateObjects);
}

function checkCollision(a,b){
  const rectA = a.getBoundingClientRect();
  const rectB = b.getBoundingClientRect();
  return !(rectA.top>rectB.bottom || rectA.bottom<rectB.top || rectA.right<rectB.left || rectA.left>rectB.right);
}

function endGame(){
  gameOver=true;
  document.getElementById("finalScore").textContent = score;
  document.getElementById("gameOverScreen").style.display = "block";
}

// === AVVIO ===
spawnObstacle();
spawnFish();
spawnBigFish();
moveShark();
updateObjects();
</script>
</body>
</html>
